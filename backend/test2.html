<!-- <form
	action="http://127.0.0.1:5000/api/series"
	method="POST"
	enctype="multipart/form-data"
>
	<label> series thumbanil</label>
	<input type="file" name="series_thumbnail" />
	<label>Series Name</label>
	<input type="text" name="series_title" />
	<label>Genre</label>
	<input type="text" name="series_genres" />
	<label>Genre</label>
	<input type="text" name="series_genres" />
	<label>Genre</label>
	<input type="text" name="series_genres" />

	<label>staff name</label>
	<input type="text" name="series_staff[0][name]" />
	<label>staff surname</label>
	<input type="text" name="series_staff[0][surname]" />
	<label>staff role</label>
	<input type="text" name="series_staff[0][role]" />

	<label>staff name</label>
	<input type="text" name="series_staff[1][name]" />
	<label>staff surname</label>
	<input type="text" name="series_staff[1][surname]" />
	<label>staff role</label>
	<input type="text" name="series_staff[1][role]" />

	<label>Episode Description:</label>
	<textarea name="series_desc"></textarea>
	<label>Year of Production:</label>
	<textarea name="series_year_of_production"></textarea>
	<br />
	<br />
	<div>
		<label>thumbanil</label>
		<input type="file" name="video_thumbnails" />

		<label>File</label>
		<input type="file" name="videos" />
		<br />
		<label>Title:</label>
		<input type="text" name="episode_titles" />
		<label>Episode Description:</label>
		<textarea name="episode_desc"></textarea>
	</div>
	<br />
	<br />
	<br />
	<div>
		<label>thumbanil</label>
		<input type="file" name="video_thumbnails" />

		<label>File</label>
		<input type="file" name="videos" />
		<br />
		<label>Title:</label>
		<input type="text" name="episode_titles" />
		<label>Episode Description:</label>
		<textarea name="episode_desc"></textarea>
	</div>
	<button type="submit">Upload</button>
</form> -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Socket Thing1</title>
	</head>
	<body>
		Client1
		<video
			src="http://localhost:5000/api/videos/656623c900a0869bc3cda3b2"
			controls
			autoplay
		></video>
	</body>
	<script>
		const throttle = (func, limit) => {
			let lastFunc;
			let lastRan;
			return function () {
				const context = this;
				const args = arguments;
				if (!lastRan) {
					func.apply(context, args);
					lastRan = Date.now();
				} else {
					clearTimeout(lastFunc);
					lastFunc = setTimeout(function () {
						if (Date.now() - lastRan >= limit) {
							func.apply(context, args);
							lastRan = Date.now();
						}
					}, limit - (Date.now() - lastRan));
				}
			};
		};
		// Create WebSocket connection.
		const HEARTBEAT_TIMEOUT = 1000 * 5 + 1000 * 1; // 5 + 1 second
		const HEARTBEAT_VALUE = 1;
		const ws = new WebSocket(
			"ws://localhost:5000/api/rooms/1235678?videoId=656623c900a0869bc3cda3b2"
		);
		const video = document.querySelector("video");
		function closeConnection() {
			if (!!ws) {
				ws.close();
			}
		}

		function heartbeat() {
			if (!ws) {
				return;
			} else if (!!ws.pingTimeout) {
				clearTimeout(ws.pingTimeout);
			}

			ws.pingTimeout = setTimeout(() => {
				ws.close();

				// business logic for deciding whether or not to reconnect
			}, HEARTBEAT_TIMEOUT);

			const data = new Uint8Array(1);

			data[0] = HEARTBEAT_VALUE;

			ws.send(data);
		}

		video.addEventListener(
			"play",
			throttle((event) => {
				ws.send(["play", video.currentTime]);
			}, 50)
		);

		video.addEventListener(
			"pause",
			throttle((event) => {
				ws.send(["pause", video.currentTime]);
			}, 50)
		);

		video.addEventListener("timeupdate", (event) => {
			ws.send(["timeupdate", video.currentTime]);
		});

		// Connection opened
		ws.addEventListener("open", function (event) {
			console.log("Connected to WS Server");
		});

		// Listen for messages~
		ws.addEventListener("message", function (event) {
			// let data = JSON.stringify(event.data);
			console.log(typeof event.data);
			if ("string" != typeof event.data) {
				console.log(heartbeat);
				heartbeat();
				return;
			}
			let arrData = event.data.split(",");

			if (arrData[0] == "play") {
				video.currentTime = parseFloat(arrData[1]);
				video.play();
			}
			if (arrData[0] == "pause") {
				video.pause();
			}
			if (arrData[0] == "timeupdate") {
				console.log("cos");
				if (
					arrData[1] - video.currentTime > 5 ||
					arrData[1] - video.currentTime < -5
				) {
					video.currentTime = parseFloat(arrData[1]);
					video.play();
				}
			}

			console.log(event.data);
		});

		const sendMessage = () => {
			ws.send("Hello From Client1!");
		};
	</script>
</html>
